//ajax for dropdown to add additional charts if wanted

function addChart(clicked){
    const item = $(clicked).data('item-name');
    const url = $(clicked).data('targ-url');
    const ticker = $(clicked).data('ticker');
    $.ajax({
        url: url,
        type: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        data: JSON.stringify({
            addItem: item,
            ticker: ticker
        }),
        success: function(chartJSON){
            const chartId = item + '_chart'
            if (typeof(chartJSON) == 'string'){
                chartJSON = JSON.parse(chartJSON);
            }

            //add new chart to new chart div, then recreate new chart div to prep
            //check that chart doesn't already exist
            if ($('#'+ chartId).length == 0){
                let icon = {
                    'width': 448,
                    'ascent': 512,
                    'descent': 0,
                    'path': `M 32.00,384.00
                    C 32.00,384.00 32.00,88.00 32.00,88.00
                      32.00,88.00 32.00,59.00 32.00,59.00
                      32.00,59.00 32.00,45.00 32.00,45.00
                      32.07,30.30 39.25,17.50 51.00,8.76
                      54.50,6.15 57.89,4.18 62.00,2.70
                      68.35,0.41 71.35,0.01 78.00,0.00
                      78.00,0.00 267.00,0.00 267.00,0.00
                      267.00,0.00 372.00,0.00 372.00,0.00
                      396.52,0.29 415.96,21.96 416.00,46.00
                      416.00,46.00 416.00,384.00 416.00,384.00
                      416.00,384.00 32.00,384.00 32.00,384.00 Z
                    M 124.00,65.30
                    C 113.99,68.62 112.12,76.48 112.00,86.00
                      112.00,86.00 112.00,122.00 112.00,122.00
                      112.00,122.00 112.00,296.00 112.00,296.00
                      112.01,301.14 112.23,307.50 115.01,311.98
                      120.57,320.99 134.11,321.51 140.35,312.96
                      143.74,308.31 143.99,301.54 144.00,296.00
                      144.00,296.00 144.00,117.00 144.00,117.00
                      144.00,117.00 144.00,106.00 144.00,106.00
                      144.00,93.66 147.74,67.82 131.00,65.30
                      128.64,64.84 126.34,65.07 124.00,65.30 Z
                    M 220.00,65.30
                    C 209.99,68.62 208.12,76.48 208.00,86.00
                      208.00,86.00 208.00,122.00 208.00,122.00
                      208.00,122.00 208.00,296.00 208.00,296.00
                      208.01,301.54 208.26,308.31 211.65,312.96
                      217.89,321.51 231.43,320.99 236.99,311.98
                      239.77,307.50 239.99,301.14 240.00,296.00
                      240.00,296.00 240.00,117.00 240.00,117.00
                      240.00,117.00 240.00,106.00 240.00,106.00
                      240.00,93.66 243.74,67.82 227.00,65.30
                      224.64,64.84 222.34,65.07 220.00,65.30 Z
                    M 316.00,65.30
                    C 305.99,68.62 304.12,76.48 304.00,86.00
                      304.00,86.00 304.00,122.00 304.00,122.00
                      304.00,122.00 304.00,296.00 304.00,296.00
                      304.01,301.54 304.26,308.31 307.65,312.96
                      313.89,321.51 327.43,320.99 332.99,311.98
                      335.77,307.50 335.99,301.14 336.00,296.00
                      336.00,296.00 336.00,117.00 336.00,117.00
                      336.00,117.00 336.00,106.00 336.00,106.00
                      336.00,93.66 339.74,67.82 323.00,65.30
                      320.64,64.84 318.34,65.07 316.00,65.30 Z
                    M 10.00,416.65
                    C 10.00,416.65 47.00,416.00 47.00,416.00
                      47.00,416.00 120.00,416.00 120.00,416.00
                      120.00,416.00 348.00,416.00 348.00,416.00
                      348.00,416.00 430.00,416.00 430.00,416.00
                      432.53,416.00 435.59,415.89 438.00,416.65
                      446.61,419.35 447.99,426.19 448.00,434.00
                      448.00,434.00 448.00,464.00 448.00,464.00
                      447.83,476.21 441.25,479.98 430.00,480.00
                      430.00,480.00 321.00,480.00 321.00,480.00
                      318.73,480.00 315.34,479.78 313.39,481.02
                      310.18,483.07 304.75,496.85 302.04,501.00
                      296.24,509.87 290.00,511.98 280.00,512.00
                      280.00,512.00 168.00,512.00 168.00,512.00
                      158.00,511.98 151.76,509.87 145.96,501.00
                      143.25,496.85 137.82,483.07 134.61,481.02
                      132.66,479.78 129.27,480.00 127.00,480.00
                      127.00,480.00 18.00,480.00 18.00,480.00
                      5.81,479.98 0.07,475.72 0.00,463.00
                      0.00,463.00 0.00,440.00 0.00,440.00
                      0.00,429.51 -1.61,421.53 10.00,416.65 Z`,

                }
                config = {response: true,
                displayModeBar: true,
                displayLogo: false,
                modeBarButtonsToAdd: [{
                    name: 'Delete',
                    icon: icon,
                    //need to transform b/c plotly icons use bottom to top y axis
                    flip: true,
                    click: function(graphDiv) {
                        //graphDiv gets the DOM element directly, so just use remove method
                        graphDiv.remove();
                    }}]
                };
                Plotly.setPlotConfig(config)
                //change id of newChart into item
                $('#newChart').attr('id', chartId);
                Plotly.plot(chartId, chartJSON);
                //add newChart div back in 
                $('<div><div id="newChart"></div></div>').insertAfter("#"+chartId)
            }

        },
        error: function(errorMsg){
            console.log(errorMsg)
        }
    })
}
